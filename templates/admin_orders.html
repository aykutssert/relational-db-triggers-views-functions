<!-- templates/admin_orders.html -->
{% extends "base.html" %}
{% block title %}SipariÅŸ YÃ¶netimi{% endblock %}
{% block content %}
<h1>SipariÅŸ YÃ¶netimi</h1>

<div class="card" style="background: #e8f5e8; margin-bottom: 20px;">
    <h3>ğŸ“Š SipariÅŸ Ä°statistikleri</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
            <h3 style="color: #ff9800;">{{ orders|selectattr("status", "equalto", "pending")|list|length }}</h3>
            <p>Bekleyen SipariÅŸler</p>
        </div>
        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
            <h3 style="color: #4CAF50;">{{ orders|selectattr("status", "equalto", "completed")|list|length }}</h3>
            <p>Tamamlanan SipariÅŸler</p>
        </div>
        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
            <h3 style="color: #f44336;">{{ orders|selectattr("status", "equalto", "cancelled")|list|length }}</h3>
            <p>Ä°ptal Edilen SipariÅŸler</p>
        </div>
        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
            <h3 style="color: #2196F3;">{{ orders|length }}</h3>
            <p>Toplam SipariÅŸ</p>
        </div>
    </div>
</div>

<table class="table">
    <thead>
        <tr>
            <th>SipariÅŸ No</th>
            <th>MÃ¼ÅŸteri</th>
            <th>Tarih</th>
            <th>ÃœrÃ¼nler</th>
            <th>Toplam</th>
            <th>Durum</th>
            <th>Ä°ÅŸlemler</th>
        </tr>
    </thead>
    <tbody>
        {% for order in orders %}
        <tr>
            <td><strong>#{{ order.order_id }}</strong></td>
            <td>{{ order.customer_name }}</td>
            <td>{{ order.order_date.strftime('%d.%m.%Y %H:%M') }}</td>
            <td style="max-width: 200px;">{{ order.order_items }}</td>
            <td><strong>{{ order.total_amount }} TL</strong></td>
            <td>
                {% if order.status == 'completed' %}
                    <span style="background: #4CAF50; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">âœ… TamamlandÄ±</span>
                {% elif order.status == 'pending' %}
                    <span style="background: #ff9800; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">â³ Bekliyor</span>
                {% else %}
                    <span style="background: #f44336; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">âŒ Ä°ptal</span>
                {% endif %}
            </td>
            <td>
                <form method="POST" action="{{ url_for('update_order_status') }}" style="display: inline;">
                    <input type="hidden" name="order_id" value="{{ order.order_id }}">
                    <select name="new_status" onchange="this.form.submit()" style="padding: 5px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>â³ Bekliyor</option>
                        <option value="completed" {% if order.status == 'completed' %}selected{% endif %}>âœ… TamamlandÄ±</option>
                        <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>âŒ Ä°ptal</option>
                    </select>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if not orders %}
<div class="card" style="text-align: center; padding: 50px;">
    <h3>ğŸ“¦ HenÃ¼z sipariÅŸ yok</h3>
    <p>MÃ¼ÅŸteriler sipariÅŸ vermeye baÅŸladÄ±ÄŸÄ±nda burada gÃ¶rÃ¼necekler.</p>
</div>
{% endif %}

<div class="card" style="background: #e3f2fd; margin-top: 30px;">
    <h4>ğŸ’¡ SipariÅŸ YÃ¶netimi Bilgileri</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
        <div>
            <h5>ğŸ”„ Durum DeÄŸiÅŸiklikleri:</h5>
            <ul style="padding-left: 20px;">
                <li><strong>Bekliyor:</strong> Yeni verilen sipariÅŸler</li>
                <li><strong>TamamlandÄ±:</strong> HazÄ±rlanÄ±p gÃ¶nderilen sipariÅŸler</li>
                <li><strong>Ä°ptal:</strong> Ä°ptal edilen sipariÅŸler</li>
            </ul>
        </div>
        <div>
            <h5>âš¡ Otomatik Ä°ÅŸlemler:</h5>
            <ul style="padding-left: 20px;">
                <li>SipariÅŸ verildiÄŸinde stok otomatik dÃ¼ÅŸer</li>
                <li>Toplam tutar otomatik hesaplanÄ±r</li>
                <li>TÃ¼m iÅŸlemler trigger'larla loglanÄ±r</li>
            </ul>
        </div>
    </div>
</div>

<div class="card" style="background: #fff3e0;">
    <h4>ğŸ¯ Test Ä°Ã§in:</h4>
    <p>MÃ¼ÅŸteri panelinden sipariÅŸ vererek trigger'larÄ±n nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± test edebilirsiniz. SipariÅŸ verildiÄŸinde:</p>
    <ul style="padding-left: 20px; margin: 10px 0;">
        <li><strong>order_stock_update</strong> trigger'Ä± Ã§alÄ±ÅŸÄ±r (stok dÃ¼ÅŸer)</li>
        <li><strong>order_total_calculation</strong> trigger'Ä± Ã§alÄ±ÅŸÄ±r (toplam hesaplanÄ±r)</li>
        <li>Triggers sekmesinden bu loglarÄ± gÃ¶rebilirsiniz</li>
    </ul>
</div>
{% endblock %}